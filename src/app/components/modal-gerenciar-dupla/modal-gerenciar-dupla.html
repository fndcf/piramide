<div class="modal-overlay" *ngIf="mostrar" (click)="fecharModal()">
  <div class="modal-content gerenciar-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>‚öôÔ∏è Gerenciar Dupla</h3>
      <button class="btn-close" (click)="fecharModal()">√ó</button>
    </div>
    
    <div class="modal-body" *ngIf="dupla">
      <!-- Informa√ß√µes da Dupla -->
      <div class="dupla-header">
        <div class="dupla-info">
          <h4>{{ dupla.jogador1 }} / {{ dupla.jogador2 }}</h4>
          <div class="dupla-stats">
            <span class="stat-item">
              <strong>Posi√ß√£o:</strong> {{ posicaoAtual }}¬∫ lugar
            </span>
            <span class="stat-item">
              <strong>Estat√≠sticas:</strong> {{ dupla.vitorias }}V - {{ dupla.derrotas }}D
            </span>
          </div>
        </div>
      </div>

      <!-- Abas de Navega√ß√£o -->
      <div class="tabs-navigation">
        <button 
          class="tab-button" 
          [class.active]="abaSelecionada === 'info'"
          (click)="selecionarAba('info')">
          üìù Informa√ß√µes
        </button>
        <button 
          class="tab-button" 
          [class.active]="abaSelecionada === 'posicao'"
          (click)="selecionarAba('posicao')">
          üìä Reposicionar
        </button>
      </div>

      <!-- Aba de Informa√ß√µes -->
      <div class="tab-content" *ngIf="abaSelecionada === 'info'">
        <form (ngSubmit)="onSalvarInformacoes()" #infoForm="ngForm">
          <div class="form-grid">
            <div class="form-group">
              <label>Jogador 1 *</label>
              <input 
                type="text" 
                [(ngModel)]="duplaEditada.jogador1" 
                name="jogador1"
                class="form-control"
                required
                [disabled]="loading">
            </div>
            
            <div class="form-group">
              <label>Jogador 2 *</label>
              <input 
                type="text" 
                [(ngModel)]="duplaEditada.jogador2" 
                name="jogador2"
                class="form-control"
                required
                [disabled]="loading">
            </div>
            
            <div class="form-group">
              <label>Telefone *</label>
              <input 
                type="tel" 
                [(ngModel)]="duplaEditada.telefone" 
                name="telefone"
                class="form-control"
                required
                [disabled]="loading"
                (input)="formatarTelefone($event)">
            </div>
            
            <div class="form-group">
              <label>Email</label>
              <input 
                type="email" 
                [(ngModel)]="duplaEditada.email" 
                name="email"
                class="form-control"
                [disabled]="loading">
            </div>
            
            <div class="form-group stats-group">
              <label>Vit√≥rias</label>
              <input 
                type="number" 
                [(ngModel)]="duplaEditada.vitorias" 
                name="vitorias"
                class="form-control"
                min="0"
                [disabled]="loading">
            </div>
            
            <div class="form-group stats-group">
              <label>Derrotas</label>
              <input 
                type="number" 
                [(ngModel)]="duplaEditada.derrotas" 
                name="derrotas"
                class="form-control"
                min="0"
                [disabled]="loading">
            </div>
          </div>
          
          <div class="form-group full-width">
            <label>Observa√ß√µes</label>
            <textarea 
              [(ngModel)]="duplaEditada.observacoes" 
              name="observacoes"
              class="form-control"
              rows="3"
              [disabled]="loading"
              placeholder="Observa√ß√µes sobre a dupla..."></textarea>
          </div>
          
          <div class="form-actions">
            <button 
              type="button" 
              class="btn-cancelar" 
              (click)="fecharModal()"
              [disabled]="loading">
              Cancelar
            </button>
            <button 
              type="submit" 
              class="btn-salvar" 
              [disabled]="loading || !infoForm.form.valid">
              <span *ngIf="loading">Salvando...</span>
              <span *ngIf="!loading">Salvar Altera√ß√µes</span>
            </button>
          </div>
        </form>
      </div>

      <!-- Aba de Reposicionamento -->
      <div class="tab-content" *ngIf="abaSelecionada === 'posicao'">
        <div class="reposicao-section">
          <div class="posicao-atual">
            <h5>üìç Posi√ß√£o Atual</h5>
            <div class="posicao-card atual">
              <span class="posicao-numero">{{ posicaoAtual }}¬∫</span>
              <span class="posicao-label">lugar</span>
            </div>
          </div>

          <div class="arrow-separator">‚û°Ô∏è</div>

          <div class="nova-posicao">
            <h5>üéØ Nova Posi√ß√£o</h5>
            <div class="posicao-input-group">
              <select 
                [(ngModel)]="novaPosicao" 
                (change)="onNovaPosicaoChange()"
                class="posicao-select"
                [disabled]="loading">
                <option *ngFor="let pos of [].constructor(getTotalDuplas()); let i = index" [value]="i + 1">
                  {{ i + 1 }}¬∫ lugar
                </option>
              </select>
            </div>
          </div>
        </div>

        <div class="duplas-afetadas" *ngIf="duplasAfetadas.length > 0">
          <h5>üîÑ Duplas que ser√£o Reposicionadas</h5>
          <div class="afetadas-list">
            <div *ngFor="let item of duplasAfetadas" class="dupla-afetada">
              <div class="dupla-nome">{{ item.dupla.jogador1 }} / {{ item.dupla.jogador2 }}</div>
              <div class="movimento">
                {{ item.posicaoAtual }}¬∫ ‚Üí {{ item.novaPosicao }}¬∫
                <span class="movimento-tipo" [class]="item.novaPosicao > item.posicaoAtual ? 'desce' : 'sobe'">
                  {{ item.novaPosicao > item.posicaoAtual ? '‚Üì' : '‚Üë' }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-reposicao" *ngIf="novaPosicao !== posicaoAtual">
          <div class="preview-card">
            <h6>üìã Resumo da Opera√ß√£o</h6>
            <p>
              <strong>{{ duplaEditada.jogador1 }}/{{ duplaEditada.jogador2 }}</strong> 
              {{ novaPosicao < posicaoAtual ? 'subir√°' : 'descer√°' }} 
              {{ Math.abs(novaPosicao - posicaoAtual) }} posi√ß√£o(√µes)
            </p>
            <p><strong>{{ duplasAfetadas.length }}</strong> dupla(s) ser√£o automaticamente reposicionadas</p>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="button" 
            class="btn-cancelar" 
            (click)="fecharModal()"
            [disabled]="loading">
            Cancelar
          </button>
          <button 
            type="button" 
            class="btn-reposicionar" 
            (click)="onReposicionarDupla()"
            [disabled]="loading || novaPosicao === posicaoAtual">
            <span *ngIf="loading">Reposicionando...</span>
            <span *ngIf="!loading">Aplicar Reposicionamento</span>
          </button>
        </div>
      </div>

      <!-- Mensagens -->
      <div class="alert-message" *ngIf="mensagem" [class]="tipoMensagem">
        {{ mensagem }}
      </div>
    </div>
  </div>
</div>