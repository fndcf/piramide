<!-- src/app/components/adicionar-dupla/adicionar-dupla.html - ATUALIZADO COM VALIDA√á√ïES -->

<div class="modal-overlay" *ngIf="mostrar" (click)="fecharModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>‚ûï Adicionar Nova Dupla</h3>
      <button class="btn-close" (click)="fecharModal()">√ó</button>
    </div>
    
    <form (ngSubmit)="onSubmit()" #duplaForm="ngForm">
      <div class="form-group">
        <label>Jogador 1 *</label>
        <input 
          type="text" 
          [(ngModel)]="novaDupla.jogador1" 
          name="jogador1"
          placeholder="Nome do primeiro jogador"
          required
          minlength="2"
          [disabled]="loading"
          class="form-control">
        
        <!-- ‚úÖ NOVA VALIDA√á√ÉO VISUAL -->
        <div class="field-validation" *ngIf="novaDupla.jogador1">
          <small class="validation-error" *ngIf="novaDupla.jogador1.trim().length < 2 && novaDupla.jogador1.trim().length > 0">
            ‚ùå Nome deve ter pelo menos 2 caracteres
          </small>
          <small class="validation-success" *ngIf="novaDupla.jogador1.trim().length >= 2">
            ‚úÖ Nome v√°lido
          </small>
        </div>
      </div>
      
      <div class="form-group">
        <label>Jogador 2 *</label>
        <input 
          type="text" 
          [(ngModel)]="novaDupla.jogador2" 
          name="jogador2"
          placeholder="Nome do segundo jogador"
          required
          minlength="2"
          [disabled]="loading"
          class="form-control">
        
        <!-- ‚úÖ VALIDA√á√ïES PARA JOGADOR 2 -->
        <div class="field-validation" *ngIf="novaDupla.jogador2">
          <small class="validation-error" *ngIf="novaDupla.jogador2.trim().length < 2 && novaDupla.jogador2.trim().length > 0">
            ‚ùå Nome deve ter pelo menos 2 caracteres
          </small>
          <small class="validation-error" *ngIf="novaDupla.jogador1.trim() && novaDupla.jogador2.trim() && novaDupla.jogador1.toLowerCase().trim() === novaDupla.jogador2.toLowerCase().trim()">
            ‚ùå Os jogadores devem ser pessoas diferentes
          </small>
          <small class="validation-success" *ngIf="novaDupla.jogador2.trim().length >= 2 && novaDupla.jogador1.toLowerCase().trim() !== novaDupla.jogador2.toLowerCase().trim()">
            ‚úÖ Nome v√°lido
          </small>
        </div>
      </div>
      
      <div class="form-group">
        <label>Telefone do Respons√°vel *</label>
        <input 
          type="tel" 
          [(ngModel)]="novaDupla.telefone" 
          name="telefone"
          placeholder="(11) 99999-0000"
          required
          [disabled]="loading"
          (input)="formatarTelefone($event)"
          class="form-control"
          [class.input-error]="!validacoesTelefone.formatoValido && novaDupla.telefone"
          [class.input-success]="validacoesTelefone.formatoValido && novaDupla.telefone">
        
        <!-- ‚úÖ VALIDA√á√ïES PARA TELEFONE -->
        <div class="field-validation" *ngIf="novaDupla.telefone">
          <small class="validation-error" *ngIf="!validacoesTelefone.formatoValido">
            ‚ùå {{ validacoesTelefone.motivo }}
          </small>
          <small class="validation-success" *ngIf="validacoesTelefone.formatoValido">
            ‚úÖ Telefone v√°lido
          </small>
        </div>
        <small class="help-text">Este telefone ser√° usado para login do jogador</small>
      </div>      
      <div class="form-group">
        <label>Observa√ß√µes (opcional)</label>
        <textarea 
          [(ngModel)]="novaDupla.observacoes" 
          name="observacoes"
          placeholder="Observa√ß√µes sobre a dupla..."
          rows="3"
          [disabled]="loading"
          class="form-control"></textarea>
      </div>
      
      <!-- ‚úÖ RESUMO DA VALIDA√á√ÉO -->
      <div class="form-summary" *ngIf="novaDupla.jogador1 || novaDupla.jogador2 || novaDupla.telefone">
        <h4>üìã Verifica√ß√£o da Dupla</h4>
        <div class="summary-item">
          <span class="summary-label">Jogadores:</span>
          <span class="summary-value" 
                [class.text-error]="!novaDupla.jogador1.trim() || !novaDupla.jogador2.trim() || (novaDupla.jogador1.toLowerCase().trim() === novaDupla.jogador2.toLowerCase().trim())"
                [class.text-success]="novaDupla.jogador1.trim() && novaDupla.jogador2.trim() && (novaDupla.jogador1.toLowerCase().trim() !== novaDupla.jogador2.toLowerCase().trim())">
            {{ novaDupla.jogador1.trim() || '(Vazio)' }} / {{ novaDupla.jogador2.trim() || '(Vazio)' }}
          </span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Telefone:</span>
          <span class="summary-value"
                [class.text-error]="!validacoesTelefone.formatoValido && novaDupla.telefone"
                [class.text-success]="validacoesTelefone.formatoValido && novaDupla.telefone">
            {{ novaDupla.telefone || '(Vazio)' }}
          </span>
        </div>
        <div class="summary-status">
          <span class="status-badge" 
                [class.status-ready]="formularioValido"
                [class.status-pending]="!formularioValido">
            {{ formularioValido ? '‚úÖ Pronto para adicionar' : '‚è≥ Preencha todos os campos obrigat√≥rios' }}
          </span>
        </div>
      </div>
      
      <div class="alert-message" *ngIf="mensagem" [class]="tipoMensagem">
        {{ mensagem }}
      </div>
      
      <div class="modal-actions">
        <button 
          type="button" 
          class="btn-cancelar" 
          (click)="fecharModal()"
          [disabled]="loading">
          Cancelar
        </button>
        <button 
          type="submit" 
          class="btn-adicionar" 
          [disabled]="loading || !formularioValido">
          <span *ngIf="loading">Adicionando...</span>
          <span *ngIf="!loading">Adicionar Dupla</span>
        </button>
      </div>
    </form>
  </div>
</div>