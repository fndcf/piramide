<!-- src/app/components/seletor-piramide/seletor-piramide.html - ATUALIZADO -->

<div class="seletor-piramide-container">
  <div class="seletor-header">
    <h4>ğŸ† Visualizar PirÃ¢mide</h4>
    <p class="seletor-subtitle">Escolha qual pirÃ¢mide deseja acompanhar</p>
  </div>

  <div class="piramide-selecionada" 
       (click)="toggleDropdown()"
       [class.aberto]="mostrarDropdown">
    
    <div class="piramide-info" *ngIf="piramideAtual && !carregando">
      <span class="piramide-icone" [style.color]="piramideAtual.cor">
        {{ piramideAtual.icone }}
      </span>
      <div class="piramide-detalhes">
        <span class="piramide-nome">{{ piramideAtual.nome }}</span>
        <div class="piramide-meta">
          <span class="categoria">{{ getCategoriaTexto(piramideAtual.categoria) }}</span>
          <span class="separador">â€¢</span>
          <span class="status" [class]="getStatusBadgeClass(piramideAtual.status)">
            {{ getStatusTexto(piramideAtual.status) }}
          </span>
        </div>
      </div>
      <div class="seta-dropdown">
        <span [class.rotacionada]="mostrarDropdown">â–¼</span>
      </div>
    </div>

    <!-- âœ… NOVA: Mensagem quando nÃ£o hÃ¡ pirÃ¢mide selecionada -->
    <div class="sem-piramide-info" *ngIf="!piramideAtual && !carregando">
      <span class="icone-vazio">ğŸ—ï¸</span>
      <div class="detalhes-vazio">
        <span class="nome-vazio">Nenhuma pirÃ¢mide selecionada</span>
        <div class="meta-vazio">
          <span>Clique para escolher uma pirÃ¢mide</span>
        </div>
      </div>
      <div class="seta-dropdown">
        <span [class.rotacionada]="mostrarDropdown">â–¼</span>
      </div>
    </div>

    <div class="carregando-info" *ngIf="carregando">
      <div class="spinner-pequeno"></div>
      <span>Carregando pirÃ¢mides...</span>
    </div>
  </div>

  <!-- Dropdown de PirÃ¢mides -->
  <div class="dropdown-piramides" *ngIf="mostrarDropdown" (click)="$event.stopPropagation()">
    <!-- âœ… HEADER CORRIGIDO: Com botÃ£o de refresh -->
    <div class="dropdown-header">
      <span>PirÃ¢mides DisponÃ­veis</span>
      <div class="header-actions">
        <button class="btn-refresh-seletor" 
                (click)="refreshPiramides()" 
                [disabled]="carregando"
                title="Atualizar lista de pirÃ¢mides">
          ğŸ”„
        </button>
        <button class="btn-fechar-dropdown" (click)="fecharDropdown()">Ã—</button>
      </div>
    </div>

    <!-- âœ… INDICADOR de carregamento no dropdown -->
    <div class="dropdown-loading" *ngIf="carregando">
      <div class="spinner-pequeno"></div>
      <span>Atualizando lista...</span>
    </div>

    <div class="piramides-lista" *ngIf="!carregando">
      <div class="piramide-opcao" 
           *ngFor="let piramide of piramides; trackBy: trackByPiramideId"
           [class.atual]="piramide.id === piramideAtual?.id"
           (click)="selecionarPiramide(piramide)">
        
        <div class="opcao-conteudo">
          <span class="opcao-icone" [style.color]="piramide.cor">
            {{ piramide.icone }}
          </span>
          <div class="opcao-info">
            <span class="opcao-nome">{{ piramide.nome }}</span>
            <div class="opcao-meta">
              <span class="opcao-categoria">{{ getCategoriaTexto(piramide.categoria) }}</span>
              <span class="separador">â€¢</span>
              <span class="opcao-status" [class]="getStatusBadgeClass(piramide.status)">
                {{ getStatusTexto(piramide.status) }}
              </span>
            </div>
          </div>
          <div class="opcao-indicador" *ngIf="piramide.id === piramideAtual?.id">
            âœ“
          </div>
        </div>
      </div>

      <!-- âœ… MENSAGEM MELHORADA quando nÃ£o hÃ¡ pirÃ¢mides -->
      <div class="sem-piramides" *ngIf="piramides.length === 0">
        <span class="icone-vazio">ğŸ—ï¸</span>
        <div class="sem-piramides-content">
          <h4>Nenhuma pirÃ¢mide disponÃ­vel</h4>
          <p>Ainda nÃ£o hÃ¡ pirÃ¢mides ativas no sistema</p>
          <small>FaÃ§a login como administrador para criar pirÃ¢mides</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay para fechar dropdown -->
  <div class="dropdown-overlay" 
       *ngIf="mostrarDropdown" 
       (click)="fecharDropdown()">
  </div>
</div>